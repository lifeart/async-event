!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.async_event={})}(this,function(t){var e=function(t,e){return void 0===e&&(e={timeout:1e3}),this.callId=0,this.callback=t,this.eventsList=[],this.maxExecutionTime=e.timeout,this.setDefaults(),this.callbackWrapper.bind(this)},n={hasTask:{configurable:!0},eventProxy:{configurable:!0}};n.hasTask.get=function(){return this.isBusy&&!this.isFirstCall},e.prototype.setDefaults=function(){this.isFirstCall=!0,this.stopPropagation=!1,this.preventDefault=!1,this.isBusy=!1},e.prototype.runNextEvent=function(){this.eventsList.length&&this.handleFirstCall(this.eventsList.shift())},n.eventProxy.get=function(){var t=function(){},e=this;return{get:function(n,i){return"preventDefault"===i?(e.preventDefault=!0,t):"stopPropagation"===i?(e.stopPropagation=!0,t):n[i]},set:function(t,e,n){return t[e]=n,!0}}},e.prototype.pauseEvent=function(t){t.preventDefault(),t.stopPropagation()},e.prototype.safeCallback=function(t){return new Promise(function(e,n){var i=this;return e(new Promise(function(e,n){var s=i.callback(t),o=setTimeout(function(){n()},i.maxExecutionTime);Promise.resolve(s).then(function(){clearTimeout(o),e()}).catch(function(){clearTimeout(o),n()})}))}.bind(this))},e.prototype.handleFirstCall=function(t){return new Promise(function(e,n){var i;i=t.target,this.pauseEvent(t),this.isBusy=!0;var s=function(){try{return this.isFirstCall=!1,this.stopPropagation&&this.preventDefault?(this.setDefaults(),this.runNextEvent()):i.dispatchEvent(new t.constructor(t.type,t)),e()}catch(t){return n(t)}}.bind(this),o=function(t){try{return console.log("errror",t),s()}catch(t){return n(t)}}.bind(this);try{return this.safeCallback(new Proxy(t,this.eventProxy)).then(function(t){try{return s()}catch(t){return o(t)}}.bind(this),o)}catch(t){o(t)}}.bind(this))},e.prototype.pushEventToWaitList=function(t){this.pauseEvent(t),this.eventsList.push(t)},e.prototype.handleSecondCall=function(t){this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation(),this.setDefaults(),this.runNextEvent()},e.prototype.callbackWrapper=function(t){this.callId++,this.hasTask&&t.isTrusted?this.pushEventToWaitList(t):this.isFirstCall?this.handleFirstCall(t):this.handleSecondCall(t)},Object.defineProperties(e.prototype,n),t.EventCallback=e,t.default=e});
//# sourceMappingURL=async-event.umd.js.map
